@model dynamic

<div class="chat-container">
    <div class="chat-messages" id="chatMessages">
        <!-- Los mensajes se cargarán aquí dinámicamente -->
    </div>
    
    <div class="chat-input">
        <div class="input-group">
            <input type="text" id="messageInput" class="form-control" placeholder="Escribe un mensaje...">
            <button class="btn btn-primary" id="sendButton">Enviar</button>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/chatHub")
            .build();

        connection.on("ReceiveMessage", (senderId, message) => {
            const messageElement = document.createElement("div");
            messageElement.className = "message";
            messageElement.textContent = message;
            document.getElementById("chatMessages").appendChild(messageElement);
            
            // Reproducir sonido de notificación
            const audio = new Audio('/sounds/notification.mp3');
            audio.play();
        });

        connection.on("MessageSent", (success) => {
            if (!success) {
                alert("No se pudo enviar el mensaje.");
            }
        });

        document.getElementById("sendButton").addEventListener("click", async () => {
            const message = document.getElementById("messageInput").value;
            if (message) {
                try {
                    await connection.invoke("SendMessage", @Model.SenderId, @Model.ReceiverId, message);
                    document.getElementById("messageInput").value = "";
                } catch (err) {
                    console.error(err);
                }
            }
        });

        connection.start().catch(err => console.error(err));
    </script>
}

<style>
    .chat-container {
        height: 500px;
        display: flex;
        flex-direction: column;
    }

    .chat-messages {
        flex-grow: 1;
        overflow-y: auto;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 1rem;
    }

    .message {
        margin-bottom: 0.5rem;
        padding: 0.5rem;
        border-radius: 4px;
        background-color: #f8f9fa;
    }

    .chat-input {
        padding: 1rem;
        background-color: #f8f9fa;
        border-top: 1px solid #ddd;
    }
</style> 